schema: draft-07
name: application
description: "Example application bundle (edit in ./bundles)"
source_url: https://github.com/massdriver-cloud/demos
version: 0.0.0

params:
  required:
    - image
    - replicas
  examples:
    - __name: Development
      image: "nginx:latest"
      replicas: 1
      port: 8080
    - __name: Production
      image: "nginx:stable"
      replicas: 3
      port: 8080
  properties:
    image:
      type: string
      title: Container Image
      description: Container image to deploy
      default: "nginx:latest"
    replicas:
      type: integer
      title: Replicas
      description: Number of replicas to deploy
      default: 2
      minimum: 1
      maximum: 10
    port:
      type: integer
      title: Port
      description: Port the application listens on
      default: 8080
      minimum: 1
      maximum: 65535
    database_policy:
      type: string
      title: Database Access Policy
      description: Access policy to apply for database access
      $md.enum:
        connection: database
        options: .data.security.policies
        value: .name
    bucket_policy:
      type: string
      title: Bucket Access Policy
      description: Access policy to apply for bucket access
      $md.enum:
        connection: bucket
        options: .data.security.policies
        value: .name

connections:
  required:
    - network
    # - database
    # - bucket
  properties:
    network:
      $ref: network
    database:
      $ref: postgres
    bucket:
      $ref: bucket

artifacts:
  required: []
  properties: {}

steps:
  - path: src
    provisioner: opentofu:1.10

ui:
  ui:order:
    - image
    - replicas
    - port
    - database_policy
    - bucket_policy
    - "*"
