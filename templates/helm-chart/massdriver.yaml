# Bundle YAML Spec: https://docs.massdriver.cloud/guides/bundle-yaml-spec
# Helm Provisioner: https://docs.massdriver.cloud/provisioners/helm
# Bundle Templates: https://docs.massdriver.cloud/guides/bundle-templates

name: "{{ name }}"
description: "{{ description }}"
source_url: https://github.com/YOUR_ORG/YOUR_REPO/tree/main/bundles/{{ name }}
version: 0.0.0

steps:
  - path: chart
    provisioner: helm
    config:
      chart:
        repo: .params.chart.repository
        name: .params.chart.name
        version: .params.chart.version
      namespace: .params.namespace
      release_name: .md.package.name

params:
  examples:
    - __name: Development
      chart:
        repository: https://charts.bitnami.com/bitnami
        name: nginx
        version: "15.0.0"
      namespace: dev
    - __name: Production
      chart:
        repository: https://charts.bitnami.com/bitnami
        name: nginx
        version: "15.0.0"
      namespace: production
  required:
    - chart
    - namespace
  properties:
    chart:
      type: object
      title: Helm Chart
      description: External Helm chart to deploy
      required:
        - repository
        - name
      properties:
        repository:
          type: string
          title: Repository URL
          description: Helm chart repository URL (e.g., https://charts.bitnami.com/bitnami)
        name:
          type: string
          title: Chart Name
          description: Name of the chart in the repository
        version:
          type: string
          title: Chart Version
          description: Chart version constraint (leave empty for latest)
    namespace:
      type: string
      title: Namespace
      description: Kubernetes namespace for deployment
      default: default

connections:
{%- if connections.size > 0 %}
  required:
  {%- for conn in connections %}
    - {{ conn.name }}
  {%- endfor %}
  properties:
  {%- for conn in connections %}
    {{ conn.name }}:
      $ref: {{ conn.artifact_definition }}
  {%- endfor %}
{%- else %}
  required: []
  properties: {}
{%- endif %}

artifacts:
  properties: {}

ui:
  ui:order:
    - chart
    - namespace
    - "*"
  chart:
    ui:order:
      - repository
      - name
      - version
